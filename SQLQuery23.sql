USE [FleetOptimization]
GO

INSERT INTO [dbo].[CustomerRequests]
           ([CustId]
           ,[CustName]
           ,[MobileNo]
           ,[Addr]
           ,[JobType]
           ,[RequestDate]
           ,[OrderId]
           ,[RequestTime]
           ,[Lattitude]
           ,[Longitude])
     VALUES
           (1001
           ,'aaa'
           ,'99999'
		   ,'xxx'
           ,'install'
           ,'09-09-2016'
           ,2001
           ,'09.00'
           ,'12.32112'
           ,'80.4334')
GO

INSERT INTO [dbo].[CustomerRequests] VALUES(1025,'fdg','824888','fay','install','11-09-2016',2025,'10.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1026,'shrh','858828','gfy','repair','11-09-2016',2026,'11.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1027,'deds','658228','gyr','repair','11-09-2016',2027,'12.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1028,'iret','885428','gtt','install','11-09-2016',2028,'19.25',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1029,'jdes','676428','gtz','repair','11-09-2016',2029,'20.32',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1030,'tgrgd','898288','gfg','repair','12-09-2016',2030,'21.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1031,'dgerfs','642688','ggy','install','12-09-2016',2031,'10.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1032,'hhsfg','854288','fhy','install','12-09-2016',2032,'11.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1033,'ds5g','658728','rthr','repair','12-09-2016',2033,'12.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1034,'itsg','886728','retzz','install','12-09-2016',2034,'19.25',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1035,'jstg','886728','tyizz','repair','12-09-2016',2035,'20.32',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1036,'sgtfg','898288','yehyr','repair','12-09-2016',2036,'21.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1037,'ggrtg','864288','iuy','install','13-09-2016',2037,'10.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1038,'shurh','858288','foiy','repair','13-09-2016',2038,'11.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1039,'ddys','658228','yyr','repair','13-09-2016',2039,'12.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1040,'iryt','885428','iutt','install','13-09-2016',2040,'19.25',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1041,'juds','676428','fsdz','repair','13-09-2016',2041,'20.32',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1042,'srfgd','898288','reg','repair','13-09-2016',2042,'21.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1043,'dgufs','643288','yrgy','install','14-09-2016',2043,'10.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1044,'hhsfg','854288','ftry','install','14-09-2016',2044,'11.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1045,'dsug','658268','rtgrgd','repair','14-09-2016',2045,'12.15',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1046,'isug','886278','retzzd','install','14-09-2016',2046,'19.25',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1047,'jsug','886238','tyhdzz','repair','14-09-2016',2047,'20.32',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1048,'sgufg','892788','ydder','repair','14-09-2016',2048,'21.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1049,'jsug','882738','tfdgzz','repair','14-09-2016',2049,'20.32',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1050,'sgufg','828788','yhgds','repair','15-09-2016',2050,'21.05',null,null)

INSERT INTO [dbo].[CustomerRequests] VALUES(1051,'bbb','888888','yyy','install','16-09-2016',2051,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1052,'bbb','888888','yyy','install','16-09-2016',2052,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1053,'bbb','888888','yyy','install','16-09-2016',2053,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1054,'bbb','888888','yyy','install','16-09-2016',2054,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1055,'bbb','888888','yyy','install','16-09-2016',2055,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1056,'bbb','888888','yyy','install','16-09-2016',2056,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1057,'bbb','888888','yyy','install','16-09-2016',2057,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1058,'bbb','888888','yyy','install','16-09-2016',2058,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1059,'bbb','888888','yyy','install','17-09-2016',2059,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1060,'bbb','888888','yyy','install','17-09-2016',2060,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1061,'bbb','888888','yyy','install','17-09-2016',2061,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1062,'bbb','888888','yyy','install','17-09-2016',2062,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1063,'bbb','888888','yyy','install','17-09-2016',2063,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1064,'bbb','888888','yyy','install','17-09-2016',2064,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1065,'bbb','888888','yyy','install','17-09-2016',2065,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1066,'bbb','888888','yyy','install','17-09-2016',2066,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1067,'bbb','888888','yyy','install','18-09-2016',2067,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1068,'bbb','888888','yyy','install','18-09-2016',2068,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1069,'bbb','888888','yyy','install','18-09-2016',2069,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1070,'bbb','888888','yyy','install','18-09-2016',2070,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1071,'bbb','888888','yyy','install','18-09-2016',2071,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1072,'bbb','888888','yyy','install','18-09-2016',2072,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1073,'bbb','888888','yyy','install','18-09-2016',2073,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1074,'bbb','888888','yyy','install','18-09-2016',2074,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1075,'bbb','888888','yyy','install','18-09-2016',2075,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1076,'bbb','888888','yyy','repair','18-09-2016',2076,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1077,'bbb','888888','yyy','install','18-09-2016',2077,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1078,'bbb','888888','yyy','install','18-09-2016',2078,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1079,'bgbb','888888','yyy','install','18-09-2016',2079,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1080,'bbdb','888888','yyy','install','18-09-2016',2080,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1081,'bbb','888888','yyy','repair','19-09-2016',2081,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1082,'bgbb','888888','yyy','install','19-09-2016',2082,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1083,'bbb','888888','yyy','repair','19-09-2016',2083,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1084,'bbb','888888','yyy','install','19-09-2016',2084,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1085,'bgbb','888888','yyy','install','20-09-2016',2085,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1086,'bbb','888888','yyy','install','20-09-2016',2086,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1087,'bytbb','888888','yyy','install','20-09-2016',2087,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1088,'bbeb','888888','yyy','install','21-09-2016',2088,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1089,'bbb','888888','yyy','install','22-09-2016',2089,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1090,'bbb','888888','yyy','install','23-09-2016',2090,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1091,'bbeb','888888','yyy','install','23-09-2016',2091,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1092,'bbb','885688','yyy','install','24-09-2016',2092,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1093,'bbb','888488','yyy','install','24-09-2016',2093,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1094,'btebb','888888','yyy','install','25-09-2016',2094,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1095,'bbb','888888','yyy','install','25-09-2016',2095,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1096,'bbb','888888','yyy','repair','26-09-2016',2096,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1097,'bbb','888888','yyy','repair','26-09-2016',2097,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1098,'bbb','888888','yyy','install','27-09-2016',2098,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1099,'bbb','888888','yyy','install','30-09-2016',2099,'09.05',null,null)
INSERT INTO [dbo].[CustomerRequests] VALUES(1100,'bbb','888888','yyy','install','27-09-2016',2100,'09.05',null,null)

insert into TechnicianInfo values(3001,'hfas','75196',4001,'install','idle',5001,null,null,null)
insert into TechnicianInfo values(3002,'hfrs','74186',4001,'install','idle',5002,null,null,null)
insert into TechnicianInfo values(3003,'afrds','55726',4002,'repair','idle',5003,null,null,null)
insert into TechnicianInfo values(3004,'wfas','75166',4001,'install','idle',5001,null,null,null)
insert into TechnicianInfo values(3005,'ifrs','74156',4001,'install','idle',5002,null,null,null)
insert into TechnicianInfo values(3006,'dfrds','55426',4002,'repair','idle',5004,null,null,null)
insert into TechnicianInfo values(3007,'pfas','75136',4002,'install','idle',5005,null,null,null)
insert into TechnicianInfo values(3008,'kfrs','74126',4001,'install','idle',5004,null,null,null)
insert into TechnicianInfo values(3009,'kfrds','55126',4002,'repair','idle',5005,null,null,null)

alter table TransactionsTime modify EmpId int null

insert into TransactionsTime values(2001,null,null,'10-09-2016',1,12,2,2)
insert into TransactionsTime values(2002,null,null,'10-09-2016',2,10,1,1)
insert into TransactionsTime values(2003,null,null,'10-09-2016',1,11,3,2)
insert into TransactionsTime values(2004,null,null,'10-09-2016',3,16,3,2)
insert into TransactionsTime values(2005,null,null,'10-09-2016',2,14,1,1)
insert into TransactionsTime values(2006,null,null,'10-09-2016',1,19,2,2)
insert into TransactionsTime values(2007,null,null,'10-09-2016',1,9,2,2)
insert into TransactionsTime values(2008,null,null,'10-09-2016',2,12,1,1)
insert into TransactionsTime values(2009,null,null,'10-09-2016',2,14,2,2)
insert into TransactionsTime values(2010,null,null,'11-09-2016',5,18,2,2)
insert into TransactionsTime values(2011,null,null,'10-09-2016',4,10,3,2)
insert into TransactionsTime values(2012,null,null,'10-09-2016',1,9,2,2)
insert into TransactionsTime values(2013,null,null,'11-09-2016',3,12,2,2)
insert into TransactionsTime values(2014,null,null,'11-09-2016',2,13,3,2)
insert into TransactionsTime values(2015,null,null,'11-09-2016',3,10,3,2)
insert into TransactionsTime values(2016,null,null,'11-09-2016',1,11,2,1)
insert into TransactionsTime values(2017,null,null,'11-09-2016',2,12,1,1)
insert into TransactionsTime values(2018,null,null,'11-09-2016',2,13,2,1)
insert into TransactionsTime values(2019,null,null,'11-09-2016',2,10,1,1)
insert into TransactionsTime values(2020,null,null,'11-09-2016',3,11,2,1)
insert into TransactionsTime values(2021,null,null,'11-09-2016',3,12,2,2)
insert into TransactionsTime values(2022,null,null,'11-09-2016',4,12,3,2)
insert into TransactionsTime values(2023,null,null,'11-09-2016',3,9,2,1)
insert into TransactionsTime values(2024,null,null,'12-09-2016',3,13,2,1)
insert into TransactionsTime values(2025,null,null,'12-09-2016',2,16,3,2)
insert into TransactionsTime values(2026,null,null,'12-09-2016',1,15,3,2)
insert into TransactionsTime values(2027,null,null,'12-09-2016',1,12,2,2)
insert into TransactionsTime values(2028,null,null,'12-09-2016',2,12,2,1)
insert into TransactionsTime values(2029,null,null,'12-09-2016',3,14,2,1)
insert into TransactionsTime values(2030,null,null,'13-09-2016',2,14,3,2)
insert into TransactionsTime values(2031,null,null,'13-09-2016',2,16,2,2)
insert into TransactionsTime values(2032,null,null,'13-09-2016',2,12,2,2)
insert into TransactionsTime values(2033,null,null,'13-09-2016',3,9,2,1)
insert into TransactionsTime values(2034,null,null,'13-09-2016',3,13,2,1)
insert into TransactionsTime values(2035,null,null,'13-09-2016',2,16,3,2)
insert into TransactionsTime values(2036,null,null,'13-09-2016',1,15,3,2)
insert into TransactionsTime values(2037,null,null,'14-09-2016',1,12,2,2)
insert into TransactionsTime values(2038,null,null,'14-09-2016',2,12,2,1)
insert into TransactionsTime values(2039,null,null,'14-09-2016',3,14,2,1)
insert into TransactionsTime values(2040,null,null,'14-09-2016',2,14,3,2)
insert into TransactionsTime values(2041,null,null,'14-09-2016',2,16,2,2)
insert into TransactionsTime values(2042,null,null,'15-09-2016',6,12,2,2)
insert into TransactionsTime values(2043,null,null,'15-09-2016',3,9,2,1)
insert into TransactionsTime values(2044,null,null,'15-09-2016',3,13,2,1)
insert into TransactionsTime values(2045,null,null,'15-09-2016',2,16,3,2)
insert into TransactionsTime values(2046,null,null,'15-09-2016',1,15,3,2)
insert into TransactionsTime values(2047,null,null,'15-09-2016',1,12,2,2)
insert into TransactionsTime values(2048,null,null,'15-09-2016',2,12,2,1)
insert into TransactionsTime values(2049,null,null,'15-09-2016',3,14,2,1)
insert into TransactionsTime values(2050,null,null,'16-09-2016',2,14,3,2)
insert into TransactionsTime values(2051,null,null,'17-09-2016',1,12,2,2)
insert into TransactionsTime values(2052,null,null,'17-09-2016',2,10,1,1)
insert into TransactionsTime values(2053,null,null,'17-09-2016',1,11,3,2)
insert into TransactionsTime values(2054,null,null,'17-09-2016',3,16,3,2)
insert into TransactionsTime values(2055,null,null,'17-09-2016',2,14,1,1)
insert into TransactionsTime values(2056,null,null,'17-09-2016',1,19,2,2)
insert into TransactionsTime values(2057,null,null,'17-09-2016',1,9,2,2)
insert into TransactionsTime values(2058,null,null,'17-09-2016',2,12,1,1)
insert into TransactionsTime values(2059,null,null,'18-09-2016',2,14,2,2)
insert into TransactionsTime values(2060,null,null,'18-09-2016',5,18,2,2)
insert into TransactionsTime values(2061,null,null,'18-09-2016',4,10,3,2)
insert into TransactionsTime values(2062,null,null,'18-09-2016',1,9,2,2)
insert into TransactionsTime values(2063,null,null,'18-09-2016',3,12,2,2)
insert into TransactionsTime values(2064,null,null,'18-09-2016',2,13,3,2)
insert into TransactionsTime values(2065,null,null,'18-09-2016',3,10,3,2)
insert into TransactionsTime values(2066,null,null,'18-09-2016',1,11,2,1)
insert into TransactionsTime values(2067,null,null,'19-09-2016',2,12,1,1)
insert into TransactionsTime values(2068,null,null,'19-09-2016',2,13,2,1)
insert into TransactionsTime values(2069,null,null,'19-09-2016',2,10,1,1)
insert into TransactionsTime values(2070,null,null,'19-09-2016',3,11,2,1)
insert into TransactionsTime values(2071,null,null,'19-09-2016',3,12,2,2)
insert into TransactionsTime values(2072,null,null,'19-09-2016',4,12,3,2)
insert into TransactionsTime values(2073,null,null,'19-09-2016',3,9,2,1)
insert into TransactionsTime values(2074,null,null,'19-09-2016',3,13,2,1)
insert into TransactionsTime values(2075,null,null,'19-09-2016',2,16,3,2)
insert into TransactionsTime values(2076,null,null,'19-09-2016',1,15,3,2)
insert into TransactionsTime values(2077,null,null,'19-09-2016',1,12,2,2)
insert into TransactionsTime values(2078,null,null,'19-09-2016',2,12,2,1)
insert into TransactionsTime values(2079,null,null,'19-09-2016',3,14,2,1)
insert into TransactionsTime values(2080,null,null,'19-09-2016',2,14,3,2)
insert into TransactionsTime values(2081,null,null,'20-09-2016',2,16,2,2)
insert into TransactionsTime values(2082,null,null,'20-09-2016',2,12,2,2)
insert into TransactionsTime values(2083,null,null,'20-09-2016',3,9,2,1)
insert into TransactionsTime values(2084,null,null,'20-09-2016',3,13,2,1)
insert into TransactionsTime values(2085,null,null,'21-09-2016',2,16,3,2)
insert into TransactionsTime values(2086,null,null,'21-09-2016',1,15,3,2)
insert into TransactionsTime values(2087,null,null,'21-09-2016',1,12,2,2)
insert into TransactionsTime values(2088,null,null,'22-09-2016',2,12,2,1)
insert into TransactionsTime values(2089,null,null,'23-09-2016',3,14,2,1)
insert into TransactionsTime values(2090,null,null,'24-09-2016',2,14,3,2)
insert into TransactionsTime values(2091,null,null,'24-09-2016',2,16,2,2)
insert into TransactionsTime values(2092,null,null,'25-09-2016',6,12,2,2)
insert into TransactionsTime values(2093,null,null,'25-09-2016',3,9,2,1)
insert into TransactionsTime values(2094,null,null,'26-09-2016',3,13,2,1)
insert into TransactionsTime values(2095,null,null,'26-09-2016',2,16,3,2)
insert into TransactionsTime values(2096,null,null,'28-09-2016',1,15,3,2)
insert into TransactionsTime values(2097,null,null,'28-09-2016',1,12,2,2)
insert into TransactionsTime values(2098,null,null,'30-09-2016',2,12,2,1)
insert into TransactionsTime values(2099,null,null,'30-09-2016',3,14,2,1)
insert into TransactionsTime values(2100,null,null,'30-09-2016',2,14,3,2)

alter proc WeeklyAvgResponseTime(@EmpId int,@StartDate nvarchar,@EndDate nvarchar)
as
declare @avrg as int
print cast(@Empid as nvarchar)
print cast(@StartDate as nvarchar)
select @avrg = avg(ResponseTime) from TransactionsTime where EmpId=@EmpId and Date between @StartDate and @EndDate;
print cast(@avrg as nvarchar)
insert into AverageTimes values(@EmpId,@avrg,null,null,null)

create proc WeeklyAvgTravelTime(@EmpId int,@StartDate date,@EndDate date)
as
declare @avrg as int
select @avrg = avg(TravelTime) from TransactionsTime where EmpId=@EmpId and Date between @StartDate and @EndDate;
update  AverageTimes set AvgTravelTime=@avrg where EmpId=@EmpId

alter proc WeeklyAvgExecTime(@EmpId int,@StartDate nvarchar,@EndDate nvarchar)
as
declare @avrg as int
print cast(@EmpId as nvarchar)
select @avrg = avg(ExecutionTime) from TransactionsTime where EmpId=@EmpId and Date between @StartDate and @EndDate;
update  AverageTimes set AvgExecTime=@avrg where EmpId=@EmpId 
and Date between @StartDate and @EndDate;

declare @x as date 
declare @y as date
select @x='10-09-2016'
select @y='17-09-2016'
exec WeeklyAvgResponseTime 3001,'10/09/2016','17/09/2016'

truncate table AverageTimes

exec WeeklyAvgTravelTime 3001,'10-09-2016','17-09-2016'

alter proc WeeklyAvgWorkTime(@EmpId int,@StartDate nvarchar,@EndDate nvarchar)
as
declare @avrg as int
select @avrg = avg(ResponseTime + ExecutionTime) from TransactionsTime t where t.EmpId=@EmpId and Date between @StartDate and @EndDate;
update  AverageTimes set AvgWorkTime=@avrg where EmpId=@EmpId 

exec WeeklyAvgWorkTime 3001,'10-09-2016','17-09-2016'

alter table AverageTimes drop column AvgIdleTime

alter proc WeeklyAvgTimes(@EmpId int,@StartDate nvarchar,@EndDate nvarchar)
as
exec WeeklyAvgResponseTime @EmpId,@StartDate,@EndDate
exec WeeklyAvgTravelTime @EmpId,@StartDate,@EndDate
exec WeeklyAvgWorkTime @EmpId,@StartDate,@EndDate

exec WeeklyAvgTimes 3001,'10-09-2016','17-09-2016'

select avg(ResponseTime) as avg from TransactionsTime where EmpId=3001 and Date between '10-09-2016' and '17-09-2016';
